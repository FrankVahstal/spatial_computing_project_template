
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.5">
    
    
      
        <title>Shadow analysis - Spatial Computing Project</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.21aed14c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="orange">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#shadow-casting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Spatial Computing Project" class="md-header-nav__button md-logo" aria-label="Spatial Computing Project">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Spatial Computing Project
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Shadow analysis
            
          </span>
        </div>
      
    </div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Spatial Computing Project" class="md-nav__button md-logo" aria-label="Spatial Computing Project">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Spatial Computing Project
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      A1_Planning
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A1_Planning" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        A1_Planning
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A1_Planning/Process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A1_Planning/Products/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    <label class="md-nav__link" for="nav-3">
      A2_Configuring
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A2_Configuring" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        A2_Configuring
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A2_Configuring/Process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A2_Configuring/Products/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    <label class="md-nav__link" for="nav-4">
      A3_Massing
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A3_Massing" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        A3_Massing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1" >
    <label class="md-nav__link" for="nav-4-1">
      Process
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Process" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon"></span>
        Process
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/Process/Sun%20analysis/Sun%20analysis/" class="md-nav__link">
      Sun analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/Process/Shadow%20analysis/Shadow%20analysis/" class="md-nav__link">
      Shadow analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/Process/Visibility%20analysis/Visibility%20analysis/" class="md-nav__link">
      Visibility analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/Process/Public%20entrance%20analysis/Public%20entrance%20analysis/" class="md-nav__link">
      Public entrance analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/Process/Green%20analysis/Green%20analysis/" class="md-nav__link">
      Green analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/Process/Noise%20Analysis/Noise%20analysis/" class="md-nav__link">
      Noise analysis
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A3_Massing/Products/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    <label class="md-nav__link" for="nav-5">
      A4_Forming
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A4_Forming" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        A4_Forming
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A4_Forming/Process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A4_Forming/Products/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    <label class="md-nav__link" for="nav-7">
      Index
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Index" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Index
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/scripts/" class="md-nav__link">
      Scripts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../voxelization/" class="md-nav__link">
      Voxelization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sun/" class="md-nav__link">
      Sun analysis
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Shadow analysis
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Shadow analysis
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-initialization" class="md-nav__link">
    0. Initialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-import-meshes-context-envelope" class="md-nav__link">
    1. Import Meshes (context + envelope)
  </a>
  
    <nav class="md-nav" aria-label="1. Import Meshes (context + envelope)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-load-meshes" class="md-nav__link">
    1.1. Load Meshes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-visualize-meshes-with-pyvista" class="md-nav__link">
    1.2. Visualize Meshes (with pyvista)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-import-lattice-envelope" class="md-nav__link">
    2. Import Lattice (envelope)
  </a>
  
    <nav class="md-nav" aria-label="2. Import Lattice (envelope)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-load-the-envelope-lattice" class="md-nav__link">
    2.1. Load the Envelope Lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-visualize-the-context-mesh-envelope-lattice" class="md-nav__link">
    2.2. Visualize the Context Mesh + Envelope Lattice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-sun-vectors" class="md-nav__link">
    3. Sun Vectors
  </a>
  
    <nav class="md-nav" aria-label="3. Sun Vectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-compute-sun-vectors" class="md-nav__link">
    3.1. Compute Sun Vectors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-compute-intersection-of-sun-rays-with-context-mesh-other-direction" class="md-nav__link">
    4. Compute Intersection of Sun Rays with Context Mesh (other direction)
  </a>
  
    <nav class="md-nav" aria-label="4. Compute Intersection of Sun Rays with Context Mesh (other direction)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-preparing-the-list-of-ray-directions-and-origins" class="md-nav__link">
    4.1. Preparing the List of Ray Directions and Origins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-computing-the-intersection" class="md-nav__link">
    4.2. Computing the Intersection
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-aggregate-simulation-result-in-the-shadow-casting-lattice" class="md-nav__link">
    5. Aggregate Simulation Result in the Shadow Casting Lattice
  </a>
  
    <nav class="md-nav" aria-label="5. Aggregate Simulation Result in the Shadow Casting Lattice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-compute-the-percentage-of-time-that-each-ray-intersects-a-voxel" class="md-nav__link">
    5.1. Compute the percentage of time that each ray intersects a voxel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-store-shadow-casting-information-in-a-lattice" class="md-nav__link">
    5.2. Store shadow casting information in a Lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-visualize-the-shadow-casting-lattice" class="md-nav__link">
    5.3. Visualize the shadow casting lattice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-save-sun-access-lattice-into-a-csv" class="md-nav__link">
    6. Save Sun Access Lattice into a CSV
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-envelope-selection" class="md-nav__link">
    7. Envelope selection
  </a>
  
    <nav class="md-nav" aria-label="7. Envelope selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-visualizing-the-selection" class="md-nav__link">
    7.1. Visualizing the selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-generating-an-envelope-based-on-the-selection" class="md-nav__link">
    7.2. Generating an envelope based on the selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-visualize-the-new-available-lattice" class="md-nav__link">
    7.3. Visualize the new available lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-save-new-envelope-to-csv" class="md-nav__link">
    7.4. Save new envelope to CSV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-low-resolution-selection" class="md-nav__link">
    7.5. Low resolution selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-low-resolution-visualise-and-save" class="md-nav__link">
    7.6. Low resolution visualise and save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credits" class="md-nav__link">
    Credits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../visibility/" class="md-nav__link">
      Visibility analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/figures/" class="md-nav__link">
      Figures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/presentations/" class="md-nav__link">
      Presentations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/bibliography/" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
    <label class="md-nav__link" for="nav-8">
      Documenting (TBR)
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Documenting (TBR)" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Documenting (TBR)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../documenting/instructions/" class="md-nav__link">
      Instructions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documenting/folder_structure/" class="md-nav__link">
      Folder Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documenting/guidelines/" class="md-nav__link">
      Guidelines
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-initialization" class="md-nav__link">
    0. Initialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-import-meshes-context-envelope" class="md-nav__link">
    1. Import Meshes (context + envelope)
  </a>
  
    <nav class="md-nav" aria-label="1. Import Meshes (context + envelope)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-load-meshes" class="md-nav__link">
    1.1. Load Meshes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-visualize-meshes-with-pyvista" class="md-nav__link">
    1.2. Visualize Meshes (with pyvista)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-import-lattice-envelope" class="md-nav__link">
    2. Import Lattice (envelope)
  </a>
  
    <nav class="md-nav" aria-label="2. Import Lattice (envelope)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-load-the-envelope-lattice" class="md-nav__link">
    2.1. Load the Envelope Lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-visualize-the-context-mesh-envelope-lattice" class="md-nav__link">
    2.2. Visualize the Context Mesh + Envelope Lattice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-sun-vectors" class="md-nav__link">
    3. Sun Vectors
  </a>
  
    <nav class="md-nav" aria-label="3. Sun Vectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-compute-sun-vectors" class="md-nav__link">
    3.1. Compute Sun Vectors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-compute-intersection-of-sun-rays-with-context-mesh-other-direction" class="md-nav__link">
    4. Compute Intersection of Sun Rays with Context Mesh (other direction)
  </a>
  
    <nav class="md-nav" aria-label="4. Compute Intersection of Sun Rays with Context Mesh (other direction)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-preparing-the-list-of-ray-directions-and-origins" class="md-nav__link">
    4.1. Preparing the List of Ray Directions and Origins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-computing-the-intersection" class="md-nav__link">
    4.2. Computing the Intersection
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-aggregate-simulation-result-in-the-shadow-casting-lattice" class="md-nav__link">
    5. Aggregate Simulation Result in the Shadow Casting Lattice
  </a>
  
    <nav class="md-nav" aria-label="5. Aggregate Simulation Result in the Shadow Casting Lattice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-compute-the-percentage-of-time-that-each-ray-intersects-a-voxel" class="md-nav__link">
    5.1. Compute the percentage of time that each ray intersects a voxel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-store-shadow-casting-information-in-a-lattice" class="md-nav__link">
    5.2. Store shadow casting information in a Lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-visualize-the-shadow-casting-lattice" class="md-nav__link">
    5.3. Visualize the shadow casting lattice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-save-sun-access-lattice-into-a-csv" class="md-nav__link">
    6. Save Sun Access Lattice into a CSV
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-envelope-selection" class="md-nav__link">
    7. Envelope selection
  </a>
  
    <nav class="md-nav" aria-label="7. Envelope selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-visualizing-the-selection" class="md-nav__link">
    7.1. Visualizing the selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-generating-an-envelope-based-on-the-selection" class="md-nav__link">
    7.2. Generating an envelope based on the selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-visualize-the-new-available-lattice" class="md-nav__link">
    7.3. Visualize the new available lattice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74-save-new-envelope-to-csv" class="md-nav__link">
    7.4. Save new envelope to CSV
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75-low-resolution-selection" class="md-nav__link">
    7.5. Low resolution selection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76-low-resolution-visualise-and-save" class="md-nav__link">
    7.6. Low resolution visualise and save
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#credits" class="md-nav__link">
    Credits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="shadow-casting">Shadow casting</h1>
<p><a href="/A3_Massing/Process/Shadow%20analysis/Shadow%20analysis/">More information on the shadow casting analysis</a>  </p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="0-initialization">0. Initialization</h2>
<p>Importing all necessary libraries and specifying the inputs</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">topogenesis</span> <span class="k">as</span> <span class="nn">tg</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>
<span class="kn">import</span> <span class="nn">trimesh</span> <span class="k">as</span> <span class="nn">tm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ladybug.sunpath</span> <span class="kn">import</span> <span class="n">Sunpath</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1-import-meshes-context-envelope">1. Import Meshes (context + envelope)</h2>
<h3 id="11-load-meshes">1.1. Load Meshes</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">envelope_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/envelope.obj&#39;</span><span class="p">)</span>
<span class="n">context_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/context_with_park2.obj&#39;</span><span class="p">)</span>

<span class="c1"># load the mesh from file</span>
<span class="n">envelope_mesh</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">envelope_path</span><span class="p">)</span>
<span class="n">context_mesh</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">context_path</span><span class="p">)</span>

<span class="c1"># Check if the mesh is watertight</span>
<span class="nb">print</span><span class="p">(</span><span class="n">envelope_mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">context_mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>faces have mixed data, using slow fallback!
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>True
False
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="12-visualize-meshes-with-pyvista">1.2. Visualize Meshes (with pyvista)</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># convert mesh to pv_mesh</span>
<span class="k">def</span> <span class="nf">tri_to_pv</span><span class="p">(</span><span class="n">tri_mesh</span><span class="p">):</span>
    <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">tri_mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">pv_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">tri_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pv_mesh</span>

<span class="c1"># initiating the plotter</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># adding the meshes</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">tri_to_pv</span><span class="p">(</span><span class="n">envelope_mesh</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#abd8ff&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">tri_to_pv</span><span class="p">(</span><span class="n">context_mesh</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#aaaaaa&#39;</span><span class="p">)</span>

<span class="c1"># plotting</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div id="89584cad-b774-465b-a682-4bee449cd7e9"></div>
<div class="output_subarea output_widget_view ">
<script type="text/javascript">
var element = $('#89584cad-b774-465b-a682-4bee449cd7e9');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "f0fc3496870742c79f50cc053beca41a", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[(785.6075686833789, 708.1911636833788, 743.2184808333789),
 (65.08283250000001, -12.333572500000002, 22.69374465),
 (0.0, 0.0, 1.0)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2-import-lattice-envelope">2. Import Lattice (envelope)</h2>
<h3 id="21-load-the-envelope-lattice">2.1. Load the Envelope Lattice</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># loading the lattice from csv</span>
<span class="n">lattice_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/envelope_lowres_10.8.csv&#39;</span><span class="p">)</span>
<span class="n">envelope_lattice</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">lattice_path</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="22-visualize-the-context-mesh-envelope-lattice">2.2. Visualize the Context Mesh + Envelope Lattice</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># convert mesh to pv_mesh</span>
<span class="k">def</span> <span class="nf">tri_to_pv</span><span class="p">(</span><span class="n">tri_mesh</span><span class="p">):</span>
    <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">tri_mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">pv_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">tri_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pv_mesh</span>

<span class="c1"># initiating the plotter</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># fast visualization of the lattice</span>
<span class="n">envelope_lattice</span><span class="o">.</span><span class="n">fast_vis</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># adding the meshes</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">tri_to_pv</span><span class="p">(</span><span class="n">context_mesh</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#aaaaaa&#39;</span><span class="p">)</span>

<span class="c1"># plotting</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div id="13e5c257-062b-4a4a-a218-730c70640727"></div>
<div class="output_subarea output_widget_view ">
<script type="text/javascript">
var element = $('#13e5c257-062b-4a4a-a218-730c70640727');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "33496d4e626548d6a525019764a96a0c", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[(786.0557649294859, 708.6393599294859, 740.9666770318022),
 (65.08283250000001, -12.333572500000002, 19.993744602316283),
 (0.0, 0.0, 1.0)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="3-sun-vectors">3. Sun Vectors</h2>
<h3 id="31-compute-sun-vectors">3.1. Compute Sun Vectors</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># initiate sunpath</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">Sunpath</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="mf">4.3571</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="mf">52.0116</span><span class="p">)</span>

<span class="c1"># define sun hours : A list of hours of the year for each sun vector</span>
<span class="c1"># there are 8760 hours in a year, so the following integers refer to specific hours throughout the year</span>
<span class="n">hoys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sun_vectors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">day_multiples</span> <span class="o">=</span> <span class="mi">30</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">365</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">%</span><span class="n">day_multiples</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="mi">24</span> <span class="o">+</span> <span class="n">h</span>
            <span class="c1"># compute the sun object</span>
            <span class="n">sun</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">calculate_sun_from_hoy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c1"># extract the sun vector</span>
            <span class="n">sun_vector</span> <span class="o">=</span> <span class="n">sun</span><span class="o">.</span><span class="n">sun_vector</span><span class="o">.</span><span class="n">to_array</span><span class="p">()</span>
            <span class="c1"># apparantly, if the Z component of sun vector is positive, </span>
            <span class="c1"># it is under the horizon </span>
            <span class="k">if</span> <span class="n">sun_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">hoys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">sun_vectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sun_vector</span><span class="p">)</span>

<span class="n">sun_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sun_vectors</span><span class="p">)</span>
<span class="c1"># compute the rotation matrix </span>
<span class="n">Rz</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">36.324</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># Rotate the sun vectors to match the site rotation</span>
<span class="n">sun_vectors</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">sun_vectors</span><span class="p">,</span> <span class="n">Rz</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sun_vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>(154, 3)
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">full_lattice</span> <span class="o">=</span> <span class="n">envelope_lattice</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># convert mesh to pv_mesh</span>
<span class="k">def</span> <span class="nf">tri_to_pv</span><span class="p">(</span><span class="n">tri_mesh</span><span class="p">):</span>
    <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">tri_mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">pv_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">tri_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pv_mesh</span>

<span class="c1"># Visualize the mesh using pyvista plotter</span>
<span class="c1">#######</span>

<span class="c1"># initiating the plotter</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># fast visualization of the lattice</span>
<span class="n">full_lattice</span><span class="o">.</span><span class="n">fast_vis</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># adding the meshes</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">tri_to_pv</span><span class="p">(</span><span class="n">context_mesh</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#aaaaaa&#39;</span><span class="p">)</span>

<span class="c1"># add the sun locations, color orange</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span> <span class="o">-</span> <span class="n">sun_vectors</span> <span class="o">*</span> <span class="mi">300</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ffa500&#39;</span><span class="p">)</span>

<span class="c1"># plotting</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div id="98be49e7-1f96-4dab-9431-9eb3acc0d641"></div>
<div class="output_subarea output_widget_view ">
<script type="text/javascript">
var element = $('#98be49e7-1f96-4dab-9431-9eb3acc0d641');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a8ede39cea534b8a8d358e7f2cd6e59b", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[(987.1796013214682, 980.6322311914033, 1113.9398701989232),
 (1.8922800195791183, -4.65509011048573, 128.65254889703414),
 (0.0, 0.0, 1.0)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="4-compute-intersection-of-sun-rays-with-context-mesh-other-direction">4. Compute Intersection of Sun Rays with Context Mesh (other direction)</h2>
<h3 id="41-preparing-the-list-of-ray-directions-and-origins">4.1. Preparing the List of Ray Directions and Origins</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># constructing the sun direction (other direction) from the sun vectors in a numpy array</span>
<span class="n">sun_dirs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sun_vectors</span><span class="p">)</span>
<span class="c1"># exract the centroids of the envelope voxels</span>

<span class="n">vox_cens</span> <span class="o">=</span> <span class="n">full_lattice</span><span class="o">.</span><span class="n">centroids</span>

<span class="n">ray_dir</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ray_src</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v_cen</span> <span class="ow">in</span> <span class="n">vox_cens</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">s_dir</span> <span class="ow">in</span> <span class="n">sun_dirs</span><span class="p">:</span>
        <span class="n">ray_dir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_dir</span><span class="p">)</span>
        <span class="n">ray_src</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_cen</span><span class="p">)</span>
<span class="c1"># converting the list of directions and sources to numpy array</span>
<span class="n">ray_dir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ray_dir</span><span class="p">)</span>
<span class="n">ray_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ray_src</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of voxels to shoot rays from :&quot;</span><span class="p">,</span><span class="n">vox_cens</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of rays per each voxel :&quot;</span><span class="p">,</span><span class="n">sun_dirs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of rays to be shooted :&quot;</span><span class="p">,</span><span class="n">ray_src</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>number of voxels to shoot rays from : (540, 3)
number of rays per each voxel : (154, 3)
number of rays to be shooted : (83160, 3)
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="42-computing-the-intersection">4.2. Computing the Intersection</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># computing the intersections </span>
<span class="n">tri_id</span><span class="p">,</span> <span class="n">ray_id</span> <span class="o">=</span> <span class="n">context_mesh</span><span class="o">.</span><span class="n">ray</span><span class="o">.</span><span class="n">intersects_id</span><span class="p">(</span><span class="n">ray_origins</span><span class="o">=</span><span class="n">ray_src</span><span class="p">,</span> <span class="n">ray_directions</span><span class="o">=</span><span class="n">ray_dir</span><span class="p">,</span> <span class="n">multiple_hits</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="5-aggregate-simulation-result-in-the-shadow-casting-lattice">5. Aggregate Simulation Result in the Shadow Casting Lattice</h2>
<h3 id="51-compute-the-percentage-of-time-that-each-ray-intersects-a-voxel">5.1. Compute the percentage of time that each ray intersects a voxel</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># initializing the hits list full of zeros</span>
<span class="n">hits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ray_dir</span><span class="p">)</span>
<span class="c1"># setting the rays that had an intersection to 1</span>
<span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ray_id</span><span class="p">:</span>
    <span class="n">hits</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">sun_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sun_dirs</span><span class="p">)</span>
<span class="n">vox_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vox_cens</span><span class="p">)</span>
<span class="c1"># initiating the list of ratio</span>
<span class="n">vox_shadow_casting</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># iterate over the voxels</span>
<span class="k">for</span> <span class="n">v_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vox_count</span><span class="p">):</span>
    <span class="c1"># counter for the intersection</span>
    <span class="n">int_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># iterate over the sun rays</span>
    <span class="k">for</span> <span class="n">s_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sun_count</span><span class="p">):</span>
        <span class="c1"># computing the ray id from voxel id and sun id</span>
        <span class="n">r_id</span> <span class="o">=</span> <span class="n">v_id</span> <span class="o">*</span> <span class="n">sun_count</span> <span class="o">+</span> <span class="n">s_id</span>

        <span class="c1"># summing the intersections</span>
        <span class="n">int_count</span> <span class="o">+=</span> <span class="n">hits</span><span class="p">[</span><span class="n">r_id</span><span class="p">]</span>

    <span class="c1"># computing the percentage of the rays that DID NOT have </span>
    <span class="c1"># an intersection</span>
    <span class="n">shadow_casting</span> <span class="o">=</span> <span class="n">int_count</span><span class="o">/</span><span class="n">sun_count</span>

    <span class="c1"># add the ratio to list</span>
    <span class="n">vox_shadow_casting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shadow_casting</span><span class="p">)</span>


<span class="n">hits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span>
<span class="n">vox_shadow_casting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vox_shadow_casting</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vox_shadow_casting</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>[0.         0.21428571 0.36363636 0.43506494 0.         0.18181818
 0.40909091 0.47402597 0.         0.21428571 0.42857143 0.53896104
 0.         0.23376623 0.44805195 0.56493506 0.         0.25324675
 0.5        0.57792208 0.         0.27272727 0.55194805 0.6038961
 0.         0.2987013  0.61688312 0.62987013 0.         0.37662338
 0.59090909 0.62337662 0.         0.3961039  0.56493506 0.58441558
 0.         0.68831169 0.44155844 0.38961039 0.         0.17532468
 0.32467532 0.38961039 0.         0.17532468 0.37662338 0.44155844
 0.         0.18831169 0.4025974  0.5        0.         0.2012987
 0.40909091 0.53246753 0.         0.22077922 0.47402597 0.55844156
 0.         0.24025974 0.53896104 0.62987013 0.         0.43506494
 0.58441558 0.63636364 0.         1.         0.57792208 0.57142857
 0.         0.30519481 0.34415584 0.37662338 0.         0.22727273
 0.34415584 0.37012987 0.         0.17532468 0.32467532 0.38961039
 0.         0.17532468 0.33766234 0.41558442 0.         0.18831169
 0.37012987 0.45454545 0.         0.22727273 0.3961039  0.52597403
 0.         0.26623377 0.51298701 0.55844156 0.         0.47402597
 0.62337662 0.62337662 0.         1.         0.74675325 0.57792208
 0.         0.18181818 0.28571429 0.35714286 0.         0.17532468
 0.31168831 0.38311688 0.         0.18181818 0.30519481 0.37662338
 0.         0.16883117 0.33116883 0.38961039 0.         0.17532468
 0.35714286 0.43506494 0.         0.19480519 0.40909091 0.49350649
 0.         0.27272727 0.5        0.55844156 0.         0.46753247
 0.64935065 0.62337662 0.         0.72077922 0.72727273 0.61688312
 0.         0.17532468 0.27272727 0.36363636 0.         0.14935065
 0.30519481 0.36363636 0.         0.14285714 0.31168831 0.37662338
 0.         0.14935065 0.2987013  0.38311688 0.         0.14935065
 0.35064935 0.4025974  0.         0.18181818 0.3961039  0.42207792
 0.         0.26623377 0.48701299 0.53246753 0.         0.45454545
 0.64935065 0.61688312 0.         0.83766234 0.67532468 0.64935065
 0.         0.14935065 0.27272727 0.38961039 0.         0.14935065
 0.27272727 0.35064935 0.         0.14285714 0.25974026 0.40909091
 0.         0.12987013 0.2987013  0.4025974  0.         0.15584416
 0.30519481 0.4025974  0.         0.16883117 0.37662338 0.43506494
 0.         0.25324675 0.44155844 0.50649351 0.         0.38961039
 0.58441558 0.61688312 0.         0.66883117 0.66883117 0.67532468
 0.         0.15584416 0.30519481 0.40909091 0.         0.14285714
 0.30519481 0.38311688 0.         0.15584416 0.27272727 0.4025974
 0.         0.12987013 0.31168831 0.3961039  0.         0.13636364
 0.33766234 0.40909091 0.         0.15584416 0.35714286 0.43506494
 0.         0.22077922 0.44155844 0.55194805 0.         0.35714286
 0.55194805 0.55844156 0.         0.53896104 0.65584416 0.61688312
 0.         0.14285714 0.29220779 0.40909091 0.         0.12337662
 0.29220779 0.38311688 0.         0.14285714 0.26623377 0.37662338
 0.         0.12987013 0.31168831 0.37662338 0.         0.14935065
 0.2987013  0.37662338 0.         0.14935065 0.33116883 0.40909091
 0.         0.23376623 0.4025974  0.46103896 0.         0.35714286
 0.51298701 0.53896104 0.         0.71428571 0.59090909 0.53896104
 0.         0.14935065 0.28571429 0.38961039 0.         0.1038961
 0.26623377 0.35064935 0.         0.11688312 0.25324675 0.38961039
 0.         0.11688312 0.27272727 0.37012987 0.         0.13636364
 0.29220779 0.38961039 0.         0.14935065 0.33766234 0.41558442
 0.         0.20779221 0.36363636 0.44155844 0.         0.27922078
 0.46753247 0.51948052 0.         0.42857143 0.55844156 0.57142857
 0.         0.13636364 0.27272727 0.4025974  0.         0.11038961
 0.25974026 0.35714286 0.         0.12337662 0.27922078 0.4025974
 0.         0.11688312 0.26623377 0.38961039 0.         0.12337662
 0.31168831 0.40909091 0.         0.12987013 0.34415584 0.44805195
 0.         0.17532468 0.36363636 0.46103896 0.         0.23376623
 0.42857143 0.5        0.         0.31168831 0.49350649 0.53896104
 0.         0.14935065 0.25974026 0.41558442 0.         0.11688312
 0.25974026 0.38961039 0.         0.11688312 0.26623377 0.4025974
 0.         0.11038961 0.25974026 0.38961039 0.         0.12987013
 0.28571429 0.4025974  0.         0.12987013 0.31818182 0.42857143
 0.         0.14935065 0.35714286 0.46103896 0.         0.18831169
 0.38961039 0.49350649 0.         0.24025974 0.48701299 0.54545455
 0.         0.16883117 0.27272727 0.41558442 0.         0.13636364
 0.25974026 0.37662338 0.         0.12987013 0.25974026 0.3961039
 0.         0.11688312 0.25974026 0.3961039  0.         0.14285714
 0.2987013  0.44155844 0.         0.14285714 0.32467532 0.40909091
 0.         0.14285714 0.33116883 0.44155844 0.         0.18831169
 0.40909091 0.46753247 0.         0.22727273 0.45454545 0.50649351
 0.         0.18831169 0.2987013  0.38311688 0.         0.15584416
 0.26623377 0.37662338 0.         0.14935065 0.27922078 0.41558442
 0.         0.14285714 0.25324675 0.42207792 0.         0.15584416
 0.28571429 0.40909091 0.         0.16233766 0.31168831 0.44805195
 0.         0.17532468 0.33116883 0.45454545 0.         0.16883117
 0.37662338 0.47402597 0.         0.22077922 0.44155844 0.46753247
 0.         0.19480519 0.31818182 0.4025974  0.         0.16233766
 0.29220779 0.40909091 0.         0.16233766 0.2987013  0.4025974
 0.         0.14935065 0.28571429 0.4025974  0.         0.16233766
 0.2987013  0.40909091 0.         0.16233766 0.31818182 0.43506494
 0.         0.16883117 0.33116883 0.45454545 0.         0.16233766
 0.4025974  0.47402597 0.         0.2012987  0.42857143 0.5
 0.         0.33766234 0.37012987 0.3961039  0.         0.21428571
 0.31168831 0.3961039  0.         0.19480519 0.31168831 0.4025974
 0.         0.17532468 0.30519481 0.42207792 0.         0.17532468
 0.27922078 0.44155844 0.         0.16883117 0.32467532 0.43506494
 0.         0.17532468 0.35064935 0.44805195 0.         0.17532468
 0.4025974  0.48051948 0.         0.20779221 0.41558442 0.50649351]
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="52-store-shadow-casting-information-in-a-lattice">5.2. Store shadow casting information in a Lattice</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># getting the condition of all voxels: are they inside the envelop or not</span>
<span class="n">env_all_vox</span> <span class="o">=</span> <span class="n">full_lattice</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># all voxels</span>
<span class="n">all_vox_shadow_casting</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># v_id: voxel id in the list of only interior voxels</span>
<span class="n">v_id</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># for all the voxels, place the interiority condition of each voxel in &quot;vox_in&quot;</span>
<span class="k">for</span> <span class="n">vox_in</span> <span class="ow">in</span> <span class="n">env_all_vox</span><span class="p">:</span>
    <span class="c1"># if the voxel was outside...</span>
    <span class="k">if</span> <span class="n">vox_in</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># read its value of shadow casting and append it to the list of all voxel shadow casting</span>
        <span class="n">all_vox_shadow_casting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vox_shadow_casting</span><span class="p">[</span><span class="n">v_id</span><span class="p">])</span>
        <span class="c1"># add one to the voxel id so the next time we read the next voxel</span>
        <span class="n">v_id</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># if the voxel was not inside... </span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># add 0.0 for its shadow casting</span>
        <span class="n">all_vox_shadow_casting</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># convert to array</span>
<span class="n">shadowcasting_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_vox_shadow_casting</span><span class="p">)</span>

<span class="c1"># reshape to lattice shape</span>
<span class="n">shadowcasting_array</span> <span class="o">=</span> <span class="n">shadowcasting_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">envelope_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># convert to lattice</span>
<span class="n">shadowcasting_lattice</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">to_lattice</span><span class="p">(</span><span class="n">shadowcasting_array</span><span class="p">,</span> <span class="n">envelope_lattice</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="n">shadowcasting_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>(15, 9, 4)
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="53-visualize-the-shadow-casting-lattice">5.3. Visualize the shadow casting lattice</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># initiating the plotter</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create the spatial reference</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UniformGrid</span><span class="p">()</span>

<span class="c1"># Set the grid dimensions: shape because we want to inject our values</span>
<span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">shadowcasting_lattice</span><span class="o">.</span><span class="n">shape</span>
<span class="c1"># The bottom left corner of the data set</span>
<span class="n">grid</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">shadowcasting_lattice</span><span class="o">.</span><span class="n">minbound</span>
<span class="c1"># These are the cell sizes along each axis</span>
<span class="n">grid</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="n">shadowcasting_lattice</span><span class="o">.</span><span class="n">unit</span>

<span class="c1"># Add the data values to the cell data</span>
<span class="n">grid</span><span class="o">.</span><span class="n">point_arrays</span><span class="p">[</span><span class="s2">&quot;Shadow Casting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shadowcasting_lattice</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>  <span class="c1"># Flatten the Lattice</span>

<span class="c1"># adding the meshes</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">tri_to_pv</span><span class="p">(</span><span class="n">context_mesh</span><span class="p">),</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;wireframe&#39;</span><span class="p">)</span>

<span class="c1"># adding the volume</span>
<span class="n">opacity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">])</span><span class="o">*</span><span class="mf">1.5</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_volume</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span><span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting|</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div id="0b039191-da23-4599-8bad-903348395843"></div>
<div class="output_subarea output_widget_view ">
<script type="text/javascript">
var element = $('#0b039191-da23-4599-8bad-903348395843');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "84e60ce394cf44a797137b77c56fd72f", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[(785.6075686833789, 708.1911636833788, 743.2184808333789),
 (65.08283250000001, -12.333572500000002, 22.69374465),
 (0.0, 0.0, 1.0)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="6-save-sun-access-lattice-into-a-csv">6. Save Sun Access Lattice into a CSV</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># save the shadow casting latice to csv</span>

<span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/shadow_casting_lowres.csv&#39;</span><span class="p">)</span>
<span class="n">shadowcasting_lattice</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">RegularGridInterpolator</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># loading the lattice from csv</span>
<span class="n">lattice_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/envelope_highres_3.6.csv&#39;</span><span class="p">)</span>
<span class="n">highres_env_lattice</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">lattice_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">highres_env_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>(43, 24, 11)
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="n">low_sunacc_lattice</span><span class="p">,</span> <span class="n">env_lattice</span><span class="p">):</span>
    <span class="c1"># line spaces</span>
    <span class="n">x_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low_sunacc_lattice</span><span class="o">.</span><span class="n">minbound</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">low_sunacc_lattice</span><span class="o">.</span><span class="n">maxbound</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">low_sunacc_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low_sunacc_lattice</span><span class="o">.</span><span class="n">minbound</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">low_sunacc_lattice</span><span class="o">.</span><span class="n">maxbound</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">low_sunacc_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">z_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low_sunacc_lattice</span><span class="o">.</span><span class="n">minbound</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">low_sunacc_lattice</span><span class="o">.</span><span class="n">maxbound</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">low_sunacc_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># interpolation function</span>
    <span class="n">interpolating_function</span> <span class="o">=</span> <span class="n">RegularGridInterpolator</span><span class="p">((</span><span class="n">x_space</span><span class="p">,</span> <span class="n">y_space</span><span class="p">,</span> <span class="n">z_space</span><span class="p">),</span> <span class="n">low_sunacc_lattice</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># high_res lattice</span>
    <span class="n">full_lattice</span> <span class="o">=</span> <span class="n">env_lattice</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># sample points</span>
    <span class="n">sample_points</span> <span class="o">=</span> <span class="n">full_lattice</span><span class="o">.</span><span class="n">centroids</span>

    <span class="c1"># interpolation</span>
    <span class="n">interpolated_values</span> <span class="o">=</span> <span class="n">interpolating_function</span><span class="p">(</span><span class="n">sample_points</span><span class="p">)</span>

    <span class="c1"># lattice construction</span>
    <span class="n">shadowcasting_lattice</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">to_lattice</span><span class="p">(</span><span class="n">interpolated_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">env_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">env_lattice</span><span class="p">)</span>

    <span class="c1"># nulling the unavailable cells</span>
    <span class="n">shadowcasting_lattice</span> <span class="o">*=</span> <span class="n">env_lattice</span>

    <span class="k">return</span> <span class="n">shadowcasting_lattice</span>

<span class="n">highres_shadowcasting_lattice</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">shadowcasting_lattice</span><span class="p">,</span><span class="n">highres_env_lattice</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># convert mesh to pv_mesh</span>
<span class="k">def</span> <span class="nf">tri_to_pv</span><span class="p">(</span><span class="n">tri_mesh</span><span class="p">):</span>
    <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">tri_mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">pv_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">tri_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pv_mesh</span>

<span class="n">base_lattice</span> <span class="o">=</span> <span class="n">highres_shadowcasting_lattice</span>
<span class="c1"># initiating the plotter</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create the spatial reference</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UniformGrid</span><span class="p">()</span>

<span class="c1"># Set the grid dimensions: shape because we want to inject our values</span>
<span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">shape</span>
<span class="c1"># The bottom left corner of the data set</span>
<span class="n">grid</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">minbound</span>
<span class="c1"># These are the cell sizes along each axis</span>
<span class="n">grid</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">unit</span>

<span class="c1"># Add the data values to the cell data</span>
<span class="n">grid</span><span class="o">.</span><span class="n">point_arrays</span><span class="p">[</span><span class="s2">&quot;Shadow Casting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>  <span class="c1"># Flatten the Lattice</span>

<span class="c1"># adding the meshes</span>
<span class="c1"># p.add_mesh(tri_to_pv(context_mesh), opacity=0.1, style=&#39;wireframe&#39;)</span>

<span class="c1"># adding the volume</span>
<span class="n">opacity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.6</span><span class="p">])</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_volume</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span><span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># plotting</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># save the shadow casting latice to csv</span>
<span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/shadow_casting_highres.csv&#39;</span><span class="p">)</span>
<span class="n">highres_shadowcasting_lattice</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="7-envelope-selection">7. Envelope selection</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># extra import function</span>
<span class="k">def</span> <span class="nf">lattice_from_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="c1"># read metadata</span>
    <span class="n">meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">meta_df</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">])</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">meta_df</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span>
    <span class="n">minbound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">meta_df</span><span class="p">[</span><span class="s1">&#39;minbound&#39;</span><span class="p">])</span>

    <span class="c1"># read lattice</span>
    <span class="n">lattice_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># create the buffer</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lattice_df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># create the lattice</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">to_lattice</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">minbound</span><span class="o">=</span><span class="n">minbound</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">l</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># loading the lattice from csv</span>
<span class="n">shadow_casting_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/shadow_casting_highres.csv&#39;</span><span class="p">)</span>
<span class="n">shadow_casting_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">shadow_casting_path</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="71-visualizing-the-selection">7.1. Visualizing the selection</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">base_lattice</span> <span class="o">=</span> <span class="n">shadow_casting_lattice</span>

<span class="c1"># Set the grid dimensions: shape + 1 because we want to inject our values on the CELL data</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UniformGrid</span><span class="p">()</span>
<span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c1"># The bottom left corner of the data set</span>
<span class="n">grid</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">minbound</span> <span class="o">-</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">unit</span> <span class="o">*</span> <span class="mf">0.5</span>
<span class="c1"># These are the cell sizes along each axis</span>
<span class="n">grid</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="n">base_lattice</span><span class="o">.</span><span class="n">unit</span> 

<span class="k">def</span> <span class="nf">create_mesh</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>

    <span class="n">lattice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">shadow_casting_lattice</span><span class="p">)</span>
    <span class="n">lattice</span><span class="p">[</span><span class="n">shadow_casting_lattice</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.0</span>
    <span class="c1"># Add the data values to the cell data</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="p">[</span><span class="s2">&quot;Agents&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>  <span class="c1"># Flatten the array!</span>
    <span class="c1"># filtering the voxels</span>
    <span class="n">threshed</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">threshold</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="c1"># adding the voxels</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">threshed</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sphere&#39;</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

    <span class="k">return</span>

<span class="n">p</span><span class="o">.</span><span class="n">add_slider_widget</span><span class="p">(</span><span class="n">create_mesh</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;always&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;classic&quot;</span><span class="p">,</span> <span class="n">pointa</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">pointb</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>



</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div id="ca5460fb-649b-4e61-b124-95412ea901cc"></div>
<div class="output_subarea output_widget_view ">
<script type="text/javascript">
var element = $('#ca5460fb-649b-4e61-b124-95412ea901cc');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "2e05c201e7034884a27b7943ea9a4c22", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>[(228.1888554793267, 134.58885319050833, 210.18885392960593),
 (36.00000190734863, -57.60000038146973, 18.00000035762787),
 (0.0, 0.0, 1.0)]</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="72-generating-an-envelope-based-on-the-selection">7.2. Generating an envelope based on the selection</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1">#threshed = grid.threshold([0.001, 1.0])</span>
<span class="c1">#new_avail_lattice = shadow_casting_lattice &lt; threshold </span>

<span class="n">lower_bound</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mf">0.45</span>
<span class="n">lower_condition</span> <span class="o">=</span> <span class="n">shadow_casting_lattice</span> <span class="o">&gt;</span> <span class="n">lower_bound</span>
<span class="n">upper_condition</span> <span class="o">=</span> <span class="n">shadow_casting_lattice</span> <span class="o">&lt;</span> <span class="n">upper_bound</span>
<span class="n">new_avail_lattice</span> <span class="o">=</span> <span class="n">lower_condition</span> <span class="o">*</span> <span class="n">upper_condition</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="73-visualize-the-new-available-lattice">7.3. Visualize the new available lattice</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># adding the avilability lattice</span>
<span class="n">new_avail_lattice</span><span class="o">.</span><span class="n">fast_vis</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="74-save-new-envelope-to-csv">7.4. Save new envelope to CSV</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/envelope_highres_3.6_shadow.csv&#39;</span><span class="p">)</span>
<span class="n">new_avail_lattice</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="75-low-resolution-selection">7.5. Low resolution selection</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1"># loading the lattice from csv</span>
<span class="n">shadow_casting_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/shadow_casting_lowres.csv&#39;</span><span class="p">)</span>
<span class="n">shadow_casting_lattice</span> <span class="o">=</span> <span class="n">lattice_from_csv</span><span class="p">(</span><span class="n">shadow_casting_path</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="c1">#threshed = grid.threshold([0.001, 1.0])</span>
<span class="c1">#new_avail_lattice = shadow_casting_lattice &lt; threshold </span>

<span class="n">lower_bound</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="mf">0.45</span>
<span class="n">lower_condition</span> <span class="o">=</span> <span class="n">shadow_casting_lattice</span> <span class="o">&gt;</span> <span class="n">lower_bound</span>
<span class="n">upper_condition</span> <span class="o">=</span> <span class="n">shadow_casting_lattice</span> <span class="o">&lt;</span> <span class="n">upper_bound</span>
<span class="n">new_avail_lattice</span> <span class="o">=</span> <span class="n">lower_condition</span> <span class="o">*</span> <span class="n">upper_condition</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="76-low-resolution-visualise-and-save">7.6. Low resolution visualise and save</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># adding the avilability lattice</span>
<span class="n">new_avail_lattice</span><span class="o">.</span><span class="n">fast_vis</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">use_ipyvtk</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/envelope_lowres_10.8_shadow.csv&#39;</span><span class="p">)</span>
<span class="n">new_avail_lattice</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
</code></pre></div>



</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="credits">Credits</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<div class="codehilite"><pre><span></span><code><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Shervin Azadi and Pirouz Nourian&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
<span class="n">__url__</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/shervinazadi/spatial_computing_workshops&quot;</span>
<span class="n">__summary__</span> <span class="o">=</span> <span class="s2">&quot;Spatial Computing Design Studio Workshop on Solar Envelope&quot;</span>
</code></pre></div>



</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../sun/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Sun analysis
              </div>
            </div>
          </a>
        
        
          <a href="../visibility/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Visibility analysis
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../../assets/javascripts/bundle.b3a72adc.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>