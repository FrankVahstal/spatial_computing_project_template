
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.5">
    
    
      
        <title>Product - Spatial Computing Project</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.21aed14c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="orange">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#agent-based-modelling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Spatial Computing Project" class="md-header-nav__button md-logo" aria-label="Spatial Computing Project">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Spatial Computing Project
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Product
            
          </span>
        </div>
      
    </div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Spatial Computing Project" class="md-nav__button md-logo" aria-label="Spatial Computing Project">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Spatial Computing Project
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      A1_Planning
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A1_Planning" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        A1_Planning
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A1_Planning/Process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A1_Planning/Products/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    <label class="md-nav__link" for="nav-3">
      A2_Configuring
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A2_Configuring" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        A2_Configuring
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A2_Configuring/Process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A2_Configuring/Products/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    <label class="md-nav__link" for="nav-4">
      A3_Massing
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A3_Massing" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        A3_Massing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1" >
    <label class="md-nav__link" for="nav-4-1">
      Process
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Process" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon"></span>
        Process
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Process/Sun%20analysis/Sun%20analysis/" class="md-nav__link">
      Sun analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Process/Shadow%20analysis/Shadow%20analysis/" class="md-nav__link">
      Shadow analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Process/Visibility%20analysis/Visibility%20analysis/" class="md-nav__link">
      Visibility analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Process/Public%20entrance%20analysis/Public%20entrance%20analysis/" class="md-nav__link">
      Public entrance analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Process/Green%20analysis/Green%20analysis/" class="md-nav__link">
      Green analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Process/Noise%20Analysis/Noise%20analysis/" class="md-nav__link">
      Noise analysis
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Product
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Product
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-choosing-the-stencils" class="md-nav__link">
    1   Choosing the stencils
  </a>
  
    <nav class="md-nav" aria-label="1   Choosing the stencils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-stencil-z-plane" class="md-nav__link">
    Code: Stencil z-plane
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-stencil-xy-plane" class="md-nav__link">
    Code: Stencil xy-plane
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to-do" class="md-nav__link">
    To do
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-agent-enviroment-information" class="md-nav__link">
    2   Agent &amp; Enviroment Information
  </a>
  
    <nav class="md-nav" aria-label="2   Agent &amp; Enviroment Information">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-loading-agents-information" class="md-nav__link">
    Code Loading Agents Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to-do_1" class="md-nav__link">
    To Do
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-initialize-the-agents" class="md-nav__link">
    3   Initialize the agents
  </a>
  
    <nav class="md-nav" aria-label="3   Initialize the agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-do_2" class="md-nav__link">
    To Do
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-the-growing-process" class="md-nav__link">
    4   The growing process
  </a>
  
    <nav class="md-nav" aria-label="4   The growing process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-do_3" class="md-nav__link">
    To Do
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    <label class="md-nav__link" for="nav-5">
      A4_Forming
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="A4_Forming" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        A4_Forming
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../A4_Forming/Process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../A4_Forming/Products/" class="md-nav__link">
      Product
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
    <label class="md-nav__link" for="nav-7">
      Index
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Index" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Index
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/scripts/" class="md-nav__link">
      Scripts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../notebooks/voxelization/" class="md-nav__link">
      Voxelization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../notebooks/sun/" class="md-nav__link">
      Sun analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../notebooks/shadow/" class="md-nav__link">
      Shadow analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../notebooks/visibility/" class="md-nav__link">
      Visibility analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/figures/" class="md-nav__link">
      Figures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/presentations/" class="md-nav__link">
      Presentations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../index/bibliography/" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
    <label class="md-nav__link" for="nav-8">
      Documenting (TBR)
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Documenting (TBR)" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Documenting (TBR)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../documenting/instructions/" class="md-nav__link">
      Instructions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documenting/folder_structure/" class="md-nav__link">
      Folder Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../documenting/guidelines/" class="md-nav__link">
      Guidelines
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-choosing-the-stencils" class="md-nav__link">
    1   Choosing the stencils
  </a>
  
    <nav class="md-nav" aria-label="1   Choosing the stencils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-stencil-z-plane" class="md-nav__link">
    Code: Stencil z-plane
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-stencil-xy-plane" class="md-nav__link">
    Code: Stencil xy-plane
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to-do" class="md-nav__link">
    To do
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-agent-enviroment-information" class="md-nav__link">
    2   Agent &amp; Enviroment Information
  </a>
  
    <nav class="md-nav" aria-label="2   Agent &amp; Enviroment Information">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-loading-agents-information" class="md-nav__link">
    Code Loading Agents Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to-do_1" class="md-nav__link">
    To Do
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-initialize-the-agents" class="md-nav__link">
    3   Initialize the agents
  </a>
  
    <nav class="md-nav" aria-label="3   Initialize the agents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-do_2" class="md-nav__link">
    To Do
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-the-growing-process" class="md-nav__link">
    4   The growing process
  </a>
  
    <nav class="md-nav" aria-label="4   The growing process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-do_3" class="md-nav__link">
    To Do
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="agent-based-modelling">Agent Based Modelling</h1>
<h3 id="1-choosing-the-stencils">1   Choosing the stencils</h3>
<p>These stencils will describe how a function is going to grow in the 3 dimensional world and what shape it will end up in. We have defined two stencils. One for the z-plane and one for the xy-plane.</p>
<h4 id="code-stencil-z-plane">Code: Stencil z-plane</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># creating neighborhood definition - center with 0 neighbours</span>
<span class="n">s_z</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">create_stencil</span><span class="p">(</span><span class="s2">&quot;von_neumann&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># setting the center to zero</span>
<span class="n">s_z</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1"># setting z neighbours to 1</span>
<span class="n">s_z</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">s_z</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<p><img alt="title" src="../../img/StencilZ.JPG" /></p>
<h4 id="code-stencil-xy-plane">Code: Stencil xy-plane</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># creating neighborhood definition - center with 1x neighbours</span>
<span class="n">s_xy</span> <span class="o">=</span> <span class="n">tg</span><span class="o">.</span><span class="n">create_stencil</span><span class="p">(</span><span class="s2">&quot;von_neumann&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># setting the center to zero</span>
<span class="n">s_xy</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1"># setting z neighbours to 0</span>
<span class="n">s_xy</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">s_xy</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<p><img alt="title" src="../../img/StencilXY.JPG" /></p>
<h4 id="to-do">To do</h4>
<p>The xy-stencil could be adjusted so that it would grow more in a square like shape. The corners would be filled as well, instead of just these 4 neighbours, there would be 8. This is still a work in process and we are not sure if this should be solved with the stencil.</p>
<h3 id="2-agent-enviroment-information">2   Agent &amp; Enviroment Information</h3>
<p>Earlier we had defined the relations between functions and their Key Performance Indicators (KPI) in a matrix created in excel. This has been transformed into the program.csv where a couple criteria have been added and some are not yet  added. The ones that are added are the maximum voxel count (representing the maximum area/volume) and the preference of each function to expand in the z-direction. In the code certain variables refer to a column with these criteria for each function (located in a row). Besides the Agents criteria &amp; relations we also need the environmental information. These pieces of information are important because they will define the placement of the functions and how they will grow and shape.</p>
<h4 id="code-loading-agents-information">Code Loading Agents Information</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># loading program (agents information) from CSV</span>
<span class="n">prgm_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="s1">&#39;../data/program.csv&#39;</span><span class="p">)</span>
<span class="n">agn_info</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">prgm_path</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="c1"># extract agent ids</span>
<span class="n">agn_ids</span> <span class="o">=</span> <span class="n">agn_info</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1"># extract agent preferences</span>
<span class="n">agn_prefs</span> <span class="o">=</span> <span class="n">agn_info</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="c1"># extract agent preference to expand in the z-direction</span>
<span class="n">agn_expandz</span> <span class="o">=</span> <span class="n">agn_info</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
<span class="c1"># extract maximum voxels of each agent agent. This represents the maximu8m area &amp; volume</span>
<span class="n">agn_vox_req</span> <span class="o">=</span> <span class="n">agn_info</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre></div>

<p><img alt="title" src="../../img/MatrixVSCode.JPG" /></p>
<p>This is a small part of the matrix used for the growing process. z_exp &amp; voxel_count are new values.  </p>
<p>One of the environmental information csv’s is the one for entrances created in w+3 where the distance fields between the entrances are created. In this notebook we have selected 6 voxels as our entrances since our metromap is based on 6 entrances. The placement of these entrances is random thus far. This will have to change to make sense on the urban scale so our building connects good with the surrounding area and infrastructure. </p>
<p><img alt="title" src="../../img/Enrances.JPG" /></p>
<h4 id="to-do_1">To Do</h4>
<ul>
<li>Add more criteria (green access, noise etc.)</li>
<li>Make sure this matrix and the one shown before are equal</li>
<li>Understand the sequence of rows and columns when new criteria are added</li>
<li>Change voxel_count into real necessary voxel count when using a higher resolution envelope</li>
<li>Add more csv’s (green access (causes problem), noise, groundfloor access, urban functions, shortest paths for pedestrians, cars, bikes, UHI-effect?)</li>
<li>Change the entrances. Perhaps these should be based on urban routes and all have separate csv’s and act as separate criteria’s? For example the most used path for cars should have quick access to an entrance where the function parking should be located.</li>
<li>Understand the order env_info picks data from the program matrix and match that with the desired data. And understand what should be added and what not. code: env_info = [ent_acc_lattice, sun_acc_lattice]</li>
</ul>
<h3 id="3-initialize-the-agents">3   Initialize the agents</h3>
<p>Here our functions are represented by a single voxel or agent as a starting point to grow later in the process. They are placed based on their Key Performance Indicators / criteria (sun access &amp; entry access) and the environmental data (sun exposure, distance fields to entrances). </p>
<p><img alt="title" src="../../img/SeedLocations.JPG" /></p>
<p>There is a problem occurring here that needs to be solved which is the fact that a lot of functions are crammed into one corner leaving them no room to grow around their starting point. Shervin has provided us a starting point to solve this problem. The idea is that we create a new criteria for all functions to stay away from each other by computing the distance field of the already existing functions. </p>
<p><strong>Code idea Shervin</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="n">a_id</span> <span class="ow">in</span> <span class="n">agn_ids</span><span class="p">:</span>    
        <span class="n">voxel_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pot_voxels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># retrieve agent preferences</span>
        <span class="n">a_pref</span> <span class="o">=</span> <span class="n">agn_prefs</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a_id</span><span class="p">)]</span>
        <span class="c1"># for all the voxels that are already occupied in the occ_lattice</span>
            <span class="n">occ_vox_1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel_indices</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">occ_lattice</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">occ_lattice</span><span class="p">)</span> 
            <span class="n">distance_to_occ</span> <span class="o">=</span> <span class="n">dist_mtrx</span><span class="p">[</span><span class="n">occ_vox_1d</span><span class="p">]</span>
            <span class="c1"># combine all of this distance lattices</span>
            <span class="n">init_env_info</span> <span class="o">=</span> <span class="n">env_info</span> <span class="o">+</span> <span class="p">[</span><span class="n">init_dist_lattice</span><span class="p">]</span>
            <span class="n">init_a_pref</span> <span class="o">=</span> <span class="n">a_pref</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
            <span class="c1"># Voxel Evaluation Loop</span>
            <span class="k">for</span> <span class="n">pot_vox</span> <span class="ow">in</span> <span class="n">avail_index</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">avail_lattice</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pot_vox</span><span class="p">)]:</span>
</code></pre></div>

<h4 id="to-do_2">To Do</h4>
<ul>
<li>Interpolate to create the seed allocation in the high resolution envelope</li>
<li>Solve Shervins Idea for the crammed corner problem</li>
<li>Add criteria to solve crammed corner problem</li>
<li>Alter criteria’s based on illogical placement of functions: reflection</li>
<li>Add multiple agents for housing units to optimize their connection with green areas</li>
</ul>
<h3 id="4-the-growing-process">4   The growing process</h3>
<p>During this process the agents will grow one voxel at a time for a certain amount of frames. This happens with the use of dynamic agents and a for loop, checking all the criteria and choosing a suitable neighbour.  </p>
<p>A the beginning of the for loop, criteria from the matrix are put in a variable that can be used in the code. </p>
<p><strong>Code</strong></p>
<div class="codehilite"><pre><span></span><code>    <span class="k">for</span> <span class="n">a_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">agn_num</span><span class="p">):</span>
        <span class="c1"># retrieve the list of the locations of the current agent</span>
        <span class="n">a_locs</span> <span class="o">=</span> <span class="n">agn_locs</span><span class="p">[</span><span class="n">a_id</span><span class="p">]</span>
        <span class="n">a_expandz</span> <span class="o">=</span> <span class="n">agn_expandz</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a_id</span><span class="p">)]</span>
        <span class="n">a_vox_req</span> <span class="o">=</span> <span class="n">agn_vox_req</span><span class="p">[</span><span class="n">a_id</span><span class="p">]</span>
        <span class="n">a_vox_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_locs</span><span class="p">)</span>

        <span class="c1"># initialize the list of free neighbours</span>
        <span class="n">free_neighs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">free_neigh_weights</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

<p>In the code below the z-neighbours and the xy-neighbours of each agent are checked if they are available and then they are compared with the criteria of that specific agent/function whether or not it prefers to grow in all directions or just horizontally. The script Shervin helped us write makes sure that if an agent want to grow horizontally, but there is no way for it to grow anymore in that direction, it still has the opportunity to grow vertically to meet the required area. This is based on the variable criteria a_expandz.</p>
<p><strong>Code</strong></p>
<div class="codehilite"><pre><span></span><code>        <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">a_locs</span><span class="p">:</span>

            <span class="c1"># retrieve the list of neighbours of the agent based on the stencil</span>
            <span class="n">z_neighs</span> <span class="o">=</span> <span class="n">avail_lattice</span><span class="o">.</span><span class="n">find_neighbours_masked</span><span class="p">(</span><span class="n">s_z</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span><span class="p">)</span>

            <span class="c1"># retrieve the list of neighbours of the agent based on the stencil</span>
            <span class="n">xy_neighs</span> <span class="o">=</span> <span class="n">avail_lattice</span><span class="o">.</span><span class="n">find_neighbours_masked</span><span class="p">(</span><span class="n">s_xy</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span><span class="p">)</span>

            <span class="n">neighs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">z_neighs</span><span class="p">,</span><span class="n">xy_neighs</span><span class="p">])</span>
            <span class="n">neigh_weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">z_neighs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">a_expandz</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">xy_neighs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)])</span>

            <span class="c1"># for each neighbour ... </span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">nw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">neighs</span><span class="p">,</span> <span class="n">neigh_weights</span><span class="p">):</span>
                <span class="c1"># compute 3D index of neighbour</span>
                <span class="n">neigh_3d_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">avail_lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="c1"># if the neighbour is available... </span>
                <span class="k">if</span> <span class="n">avail_lattice</span><span class="p">[</span><span class="n">neigh_3d_id</span><span class="p">]:</span>
                    <span class="c1"># add the neighbour to the list of free neighbours</span>
                    <span class="n">free_neighs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neigh_3d_id</span><span class="p">)</span>
                    <span class="n">free_neigh_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nw</span><span class="p">)</span>
</code></pre></div>

<p>In this part of the code there is checked if there are any free neighbours and what the value of those neighbours are. It also checks the preferences of the agents. And based of those 2 values it choses the neighbour with the highest value. </p>
<p><strong>Code</strong></p>
<div class="codehilite"><pre><span></span><code>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">free_neighs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>   
            <span class="c1"># convert free neighbours to a numpy array</span>
            <span class="n">free_neighs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">free_neighs</span><span class="p">)</span>
            <span class="c1"># retrieving the entrance access value of the free neighbours</span>
            <span class="n">neigh_vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># retrieve agent preferences</span>
            <span class="n">a_pref</span> <span class="o">=</span> <span class="n">agn_prefs</span><span class="p">[</span><span class="n">a_id</span><span class="p">]</span>
            <span class="c1"># Neighbour Evaluation Loop</span>
            <span class="k">for</span> <span class="n">neigh</span><span class="p">,</span> <span class="n">neigh_w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">free_neighs</span><span class="p">,</span><span class="n">free_neigh_weights</span><span class="p">):</span>
                <span class="n">neigh_value</span> <span class="o">=</span> <span class="n">neigh_w</span>
                <span class="c1"># for every lattice in the environment informations</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">info_lattice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">env_info</span><span class="p">):</span>
                    <span class="c1"># Here we utilise Fuzzy Logics to be able to compare different layers </span>
                    <span class="c1"># of environmental information and evaluate the voxel for the agent. </span>
                    <span class="c1"># This method is introduced, and generalised in Pirouz Nourian dissertation: </span>
                    <span class="c1"># section 5.7.3, pp. 201-208, eq. 57. You can refer to this section for </span>
                    <span class="c1"># comprehensive mathematical details.</span>
                    <span class="n">vox_val</span> <span class="o">=</span> <span class="n">info_lattice</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">neigh</span><span class="p">)]</span>
                    <span class="n">agn_vox_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">vox_val</span><span class="p">,</span> <span class="n">a_pref</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">neigh_value</span> <span class="o">*=</span> <span class="n">agn_vox_val</span>
                <span class="c1"># add the neighbour value to the list of values</span>
                <span class="n">neigh_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neigh_value</span><span class="p">)</span>

            <span class="c1"># convert to numpy array</span>
            <span class="n">neigh_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">neigh_vals</span><span class="p">)</span>
            <span class="c1"># select the neighbour with highest value </span>
            <span class="n">selected_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">neigh_vals</span><span class="p">)</span>
</code></pre></div>

<p>Finally the best neighbour is chosen, but it will only be added to the list of the agent locations (become part of the total size of that specific function/agent) if the voxel count for that function is lower than the required amount of voxels or total area/volume for that specific function. If it can grow it will be added to that list and then be set unavailable for other agents to occupie that voxel and it will be set occupied for that function. This will translate into the voxel being shown as part of a function in the images below.</p>
<p><strong>Code</strong></p>
<div class="codehilite"><pre><span></span><code>        <span class="k">if</span> <span class="n">a_vox_count</span> <span class="o">&lt;</span> <span class="n">a_vox_req</span><span class="p">:</span>
            <span class="c1"># add the newly selected neighbour location to agent locations</span>
            <span class="n">agn_locs</span><span class="p">[</span><span class="n">a_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selected_neigh_loc</span><span class="p">)</span>
            <span class="c1"># set the newly selected neighbour as UNavailable (0) in the availability lattice</span>
            <span class="n">avail_lattice</span><span class="p">[</span><span class="n">selected_neigh_3d_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># set the newly selected neighbour as OCCUPIED by current agent </span>
            <span class="c1"># (-1 means not-occupied so a_id)</span>
            <span class="n">occ_lattice</span><span class="p">[</span><span class="n">selected_neigh_3d_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">a_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
</code></pre></div>

<p><img alt="title" src="../../img/ABM1.JPG" />
<img alt="title" src="../../img/ABM2.JPG" /></p>
<p>This is the result of the growing process of the agents. However the puzzle is not solved yet, because there are still some problems to be solved here</p>
<h4 id="to-do_3">To Do</h4>
<ul>
<li>Let spaces grow in both x &amp; y direction to prevent long strokes in one direction</li>
<li>Use interpolation to reach a representation closer to our desired building</li>
<li>New envelope with green cuts and a central courtyard?</li>
<li>Add more criteria</li>
<li>Make certain spaces repel each other (for example noise producing and quit spaces)</li>
<li>What about the overhang on the north façade? Not a lot of daylight there</li>
<li>Some inner functions or housing units don’t have access to windows. Perhaps have it generate a courtyard when not a lot of voxels have direct daylight access if needed per function.</li>
<li>Have the agents negotiate and use this as another criteria to stop the growing process.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../Process/Noise%20Analysis/Noise%20analysis/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Noise analysis
              </div>
            </div>
          </a>
        
        
          <a href="../../A4_Forming/Process/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Process
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../../assets/javascripts/bundle.b3a72adc.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>